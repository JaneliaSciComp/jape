# a9a5a5c499df6dffbb41ea959825482b1f896a8500520a7559b984d4cb809b8f
# Dockerfile generated by Maru 0.1.0

# Staged build using builder container
FROM janeliascicomp/builder:1.2.1 as builder
ARG GIT_TAG=master

# Checkout and build the code
WORKDIR /tmp/app
RUN git clone --branch $GIT_TAG --depth 1 https://github.com/PreibischLab/BigStitcher.git . \
    && /usr/local/bin/buildinfo.sh \
    && mvn -Pfatjar package

# Find the built jar, based on the version in the pom file
RUN xq -r '.project.artifactId+"-"+.project.version+".jar"' pom.xml > filename \
    && mv /tmp/app/target/`cat filename` app.jar

# Create final image
FROM janeliascicomp/zulu-fx:8

COPY --from=builder /tmp/app/app.jar /app/app.jar
COPY --from=builder /buildinfo /

RUN echo "#!/bin/bash" >> /entrypoint.sh \
    && echo 'java -cp /app/app.jar net.preibisch.stitcher.plugin.BigStitcher "$@"' >> /entrypoint.sh \
    && chmod +x /entrypoint.sh
ENTRYPOINT [ "/entrypoint.sh"]
